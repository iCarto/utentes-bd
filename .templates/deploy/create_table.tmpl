-- Deploy [% change %]
[% FOREACH item IN requires -%]
-- requires: [% item %]
[% END -%]
[% FOREACH item IN conflicts -%]
-- conflicts: [% item %]
[% END -%]

BEGIN;

[%- IF schema == 'domains' %]
CREATE TABLE  [% schema %].[% table %] (
  category text default '[% table %]'
  , key text UNIQUE
  , value text
  , ordering integer
  , parent text
  , tooltip text
);
[%- ELSE %]
CREATE TABLE [% schema %].[% table %] (
    gid int PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY

    -- choose one or remove
    , geom GEOMETRY(MULTIPOLYGON, 32737)
    , geom GEOMETRY(POINT, 32737)
    , geom GEOMETRY(MULTILINESTRING, 32737)
);
CREATE INDEX ON [% schema %].[% table %] USING GIST (geom);
[% END -%]

-- ALTER TABLE [% schema %].[% table %] OWNER TO :"owner";
-- GRANT ALL ON TABLE [% schema %].[% table %] TO :"owner";
REVOKE ALL ON TABLE [% schema %].[% table %] FROM PUBLIC;
[% IF schema == 'domains' or schema == 'cbase' or schema == 'cbase_ara' -%]
GRANT SELECT ON TABLE [% schema %].[% table %] TO sirha_base_user;
[% ELSE -%]
GRANT SELECT, INSERT, UPDATE, DELETE ON [% schema %].[% table %] TO sirha_base_user;
[%- END -%]

[% IF schema == 'domains' %]
INSERT INTO [% schema %].[% table %] (key, parent) VALUES
    ('', '')
    , ('', '')
;
[% END -%]

COMMIT;
